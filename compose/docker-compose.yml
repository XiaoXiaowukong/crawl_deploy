version: "3"
networks:
  bri:
    driver: bridge
services:
  mysql:
    image: "mysql:5.7"
    container_name: "mysql"
    restart: always
    ports:
      - 33066:3306
    environment:
      - MYSQL_ROOT_PASSWORD=1qaz2wsx
      - TZ=Asia/Tokyo
    volumes:
      - /home/centos/mysql_data:/var/lib/mysql
      - /home/centos/opt/docker_deploy/mysql/my.cnf:/etc/mysql/my.cnf
    networks:
      - bri
  auction_spider:
    image: 'auction_spider:1.2'
    container_name: "auction_spider"
    restart: always
    tty: true
    ports:
      - '8889:6800'
    volumes:
      - '/home/centos/project/spider:/spider'
      - '../back/spider/scrapyd.conf:/etc/scrapyd/scrapyd.conf'
    environment:
      - TZ=Asia/Tokyo
    networks:
      - bri
  splash:
    image: scrapinghub/splash
    container_name: "splash"
    restart: always
    ports:
      - '8050:8050'
    environment:
      - TZ=Asia/Tokyo
    networks:
      - bri
  manage-web:
    image: nginx:latest
    container_name: manage-web
    restart: always
    privileged: true
    ports:
      - '8890:80'
    volumes:
      - ../front/nginx/conf.d:/etc/nginx/conf.d
      - ../front/manage-web/dist:/manage-web/dist
    environment:
      - LANG=C.UTF-8
      - TZ=Asia/Tokyo
    networks:
      - bri
  data_manage:
    image: openjdk:1.8
    container_name: data_manage
    hostname: data_manage
    environment:
      - TZ=Asia/Tokyo
    restart: always
    volumes:
      - ../back/data_manage/manage.jar:/app.jar
    ports:
      - 8891:8891
    command: [ "java","-Djava.net.preferIPv4Stack=true","-jar","/app.jar","--spring.profiles.active=test" ]
    networks:
      - bri
